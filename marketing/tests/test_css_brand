from django.test import Client, override_settings
from customers.models import Client as TenantClient, Domain
from django_tenants.utils import schema_context, get_public_schema_name
from customers.tests import TenantCleanupTestCase


@override_settings(ROOT_URLCONF='recruit_saas.urls')
class BrandingContextTest(TenantCleanupTestCase):
    """Verifies that the correct branding classes and data-attributes are delivered"""

    def test_public_marketing_branding_context(self):
        """Main site should have the 'marketing-site' class and NO agency data"""
        response = self.client.get('/', HTTP_HOST='localhost')
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'class="marketing-site')
        self.assertNotContains(response, 'data-primary-color')

    def test_tenant_agency_branding_context(self):
        """Agency subdomains should have 'agency-site' and dynamic color data"""
        with schema_context(get_public_schema_name()):
            tenant = TenantClient.objects.create(schema_name='sterling', name='Sterling Search')
            Domain.objects.create(domain='sterling.localhost', tenant=tenant, is_primary=True)

        response = self.client.get('/', HTTP_HOST='sterling.localhost')

        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'class="agency-site')
