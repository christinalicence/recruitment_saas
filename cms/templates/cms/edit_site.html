{% extends "cms/base_cms.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<div class="cms-page-wrapper">
    <div class="container-fluid px-4">
        <div class="row g-4">
            
            <div class="col-lg-5 col-xl-4">
                <div class="card editor-card-container">
                    
                    <div class="editor-header">
                        <div>
                            <a href="{% url 'cms:dashboard' %}" class="back-link">&larr; Dashboard</a>
                            <h1 class="h5 mb-0 fw-bold">Site Editor</h1>
                        </div>
                        <button type="submit" form="editor-form" class="btn btn-primary btn-sm px-4 shadow-sm">
                            Save All
                        </button>
                    </div>

                    <div class="editor-scroll-area">
                        <form method="post" enctype="multipart/form-data" id="editor-form">
                            {% csrf_token %}
                            <div class="editor-section">
                                <h6 class="section-label">Site Layout</h6>
                                {{ form|crispy }}
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-7 col-xl-8">
                <div class="preview-sticky-container">
                    <div class="preview-toolbar">
                        <span class="toolbar-label">Live Preview</span>
                        <div class="btn-group">
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setPreviewSize('desktop')" id="btn-desktop">Desktop</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setPreviewSize('tablet')" id="btn-tablet">Tablet</button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setPreviewSize('mobile')" id="btn-mobile">Mobile</button>
                        </div>
                    </div>
                    
                    <div id="preview-wrapper" class="preview-frame-wrapper desktop-mode mx-auto shadow-sm">
                        <iframe src="{% url 'cms:live_preview' %}" id="preview-frame"></iframe>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div aria-live="polite" aria-atomic="true" class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 9999;">
    <div id="messageToast" class="toast align-items-center text-white border-0 shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body fw-bold" id="toastMessage"></div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'cms/js/preview-manager.js' %}"></script>
<script src="{% static 'cms/js/contrast-checker.js' %}"></script>
{% endblock %}